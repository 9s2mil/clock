<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.cdnfonts.com/css/ds-digital" rel="stylesheet">
  <link rel="manifest" href="./manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Clock</title>
  <style>

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background-color: #0B503B;
  font-family: "DS-Digital", monospace;
    user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
}

#app {
  display: grid;
  grid-template-columns: 40% 60%; /* ì¢Œ: ì‹œê°„/ë‚ ì§œ, ìš°: ë‹¬ë ¥ */
  width: 100%;
  height: 100%;
  font-family: "DS-Digital", monospace;
}
#left-container {
  position: relative; 
  display: flex;
  flex-direction: column;
  height: 100%;
  font-size: 10px;
  color: white;
  box-sizing: border-box;
}
#year-container {
  height: 20vh;
  display: flex;
  overflow: hidden;
  box-sizing: border-box;
}
#monthday-container {
  display: flex;
  height: 47vh;

  box-sizing: border-box;
}
#monthday-container > div {
  display: flex;

  height: 100%;
  box-sizing: border-box;
}
#monthday-container > div:nth-child(1) {
  width: 10vw;
}
#monthday-container > div:nth-child(2) {
  width: 20vw;
}
#monthday-container > div:nth-child(3) {
  width: 10vw;
}
#time-container {
  display: flex;
  height: 33vh;
  box-sizing: border-box;
  overflow: hidden;
  border-top: 5px solid white; 
}

.year {
  color: white;
  font-size: 14vh;
  justify-content: left;
  align-items: top;
  margin-left: 1vw;
}
.year-text {
  color: white;
  font-size: 7vh;
  margin-left: 1vw;
  margin-bottom: 7.5vh;
}

.month {
  color: white;
  font-size: 16vh;
  justify-content: left;
  align-items: top;
  margin-left: 3vw;
}
.month-text {
  color: white;
  font-size: 7vh;
  margin-left: 0.15vw;
  margin-bottom: 33vh;
}

.today {
  color: white;
  font-size: 36vh;
  justify-content: left;
  align-items: top;
  margin-left: 3vw;
}
.today-text {
  color: white;
  font-size: 7vh;
  margin-left: 0.15vw;
  margin-bottom: 16.5vh;
}

.dissweekday {
  color: white;
  font-size: 16vh;
  justify-content: center;
  margin-left: 1.5vw;
}

.dissweekday,
.year-text,
.month-text,
.today-text {
  display: inline-flex;
  align-items: flex-end;
  line-height: 1;
  font-weight: bold;
}

.time-hour {
  flex: 8;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  box-sizing: border-box;
  font-size: 30vh;
}

.time-second {
  flex: 2;
  justify-content: left;
  overflow: hidden;
  box-sizing: border-box;
  color: yellow;
  font-size: 11vh;
  display: inline-flex;
  align-items: flex-end;
  line-height: 1;
  margin-bottom: 4vh;
}

/* ì˜¤ë¥¸ìª½: ë‹¬ë ¥ */
#right-container {
  display: flex;
  justify-content: center;
  align-items: top;
  border-left: 5px solid white; 
  padding: 2% 0;
  margin: 0%;
}

#calendar-container {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  font-size: 4.1vw;
  text-align: center;
}

#calendar-container .day {
  white-space: nowrap;  
  min-width: 2em;  
  text-align: center;
  color: white;
  font-family: "DS-Digital", monospace;
}

/* ìš”ì¼ í—¤ë” ìŠ¤íƒ€ì¼ */
.weekday {
  font-weight: bold;
  text-align: center;
  color: white;
  font-family: "DS-Digital", monospace;
}

/* ì¼ìš”ì¼ ë¹¨ê°• */
.weekday:nth-child(1),
.day.sunday {
  color: red;
}

/* í† ìš”ì¼ íŒŒë‘ */
.weekday:nth-child(7),
.day.saturday {
  color: blue;
}

#calendar-container .day,
#calendar-container .weekday {
  font-size: inherit;
}

.popButton {
  background-color: rgba(255, 255, 255, 0);
  width: 60vw;
  height: 100vh;
  display: block;
  position: fixed;
  bottom: 0%;
  right: 0%;
  border: none;
  font-size: 3vw;
  color: rgba(255, 255, 255, 0);
  padding: 2vw;
  white-space: pre-line; 
  line-height: 1.0;
  overflow-y: scroll;
}

.popup {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: clamp(280px, 50vw, 720px);
  max-height: min(80dvh, calc(100vh - 12px - env(safe-area-inset-top, 0)));
  overflow-y: auto;
  background: #fff;
  border: 1px solid #aaa;
  z-index: 9999;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
  padding: 18px 16px;
  padding-top: calc(18px + env(safe-area-inset-top, 0));
}

/* ë²„íŠ¼ ì˜ì—­ */
/* í•œ ì¤„ ìœ ì§€ */
.popup-actions {
  display: flex;
  flex-wrap: nowrap;    /* â†© wrap ê¸ˆì§€ */
  gap: 10px;
}

/* clearButton: ìë¦¬ë§Œ ìœ ì§€, ë³´ì´ì§€ ì•ŠìŒ, í´ë¦­ ë¶ˆê°€ */
.clearButton {
  visibility: hidden;   /* ë Œë”ë§Œ ìˆ¨ê¹€, ê³µê°„ì€ ì°¨ì§€ */
  pointer-events: none; /* í´ë¦­/í„°ì¹˜ ì°¨ë‹¨ */
  opacity: 0;           /* (ê°€ë“œ) ì™„ì „ íˆ¬ëª… */
}


/* ë²„íŠ¼ ê¸°ë³¸ ë² ì´ìŠ¤ */
.popup-actions button {
  appearance: none;
  border: 0;
  border-radius: 12px;
  padding: 10px 14px;
  font-weight: 700;
  letter-spacing: .2px;
  cursor: pointer;
  transition: transform .06s ease, box-shadow .18s ease, opacity .18s ease;
  box-shadow: 0 2px 0 rgba(0,0,0,.2), 0 4px 12px rgba(0,0,0,.12);
}
.popup-actions button:active { transform: translateY(1px); }


/* ê° ë²„íŠ¼ í†¤ */
#confirmText {
  background: #0B503B; /* ë°°ê²½ìƒ‰ê³¼ í†¤ì„ ë§ì¶˜ ë”¥ê·¸ë¦° */
  color: #fff;
}
#confirmText:hover { box-shadow: 0 3px 0 rgba(0,0,0,.25), 0 12px 20px rgba(11,80,59,.28); }

#cancelText {
  background: #E9ECEF;
  color: #333;
}
#cancelText:hover { box-shadow: 0 3px 0 rgba(0,0,0,.2), 0 10px 18px rgba(0,0,0,.14); }

#restoreText {
  background: #FFE08C; /* ì£¼ì˜/ë³µì› ëŠë‚Œì˜ ì›œ í†¤ */
  color: #5A3D00;
}
#restoreText:hover { box-shadow: 0 3px 0 rgba(0,0,0,.2), 0 10px 18px rgba(255,224,140,.25); }

/* í¬ì»¤ìŠ¤ ë§ (ì ‘ê·¼ì„±) */
.popup-actions button:focus {
  outline: 2px solid rgba(11,80,59,.65);
  outline-offset: 2px;
}

/* ì…ë ¥ì°½ í­/ë¼ì¸ë†’ì´ ë³´ì •(í•„ìš”ì‹œ) */
#textInput {
  width: 100%;
  line-height: 1.3;
  padding: 8px 10px;
  border: 1px solid #ddd;
  border-radius: 10px;
}

.popup-inner {
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: center;
}
/* íˆ¬ëª… 100% ìŠ¤í¬ë¦¼: ë’¤ëŠ” ë³´ì´ë˜ í„°ì¹˜ëŠ” ì°¨ë‹¨ */
.scrim {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0); 
  z-index: 9888; 
  pointer-events: auto; 
}
.clearText {
  color: rgba(0,0,0,0);
}
/* ì™¼ìª½ ì˜ì—­ì— ë¶™ëŠ” ìŠ¤í¬ë¦° */
.screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 40vw;
  height: 67vh;
  z-index: 9890; 
  display: none;
  background-color: #fff;
  overflow: hidden;
}
/* ìŠ¤í¬ë¦° ë‹«ê¸° ë²„íŠ¼ */
.screen-close {
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 2; 
  padding: 6px 10px;
  border: 0;
  border-radius: 999px;
  background: rgba(0,0,0,0.6);
  color: #fff;
  font-size: 14px;
  line-height: 1;
  cursor: pointer;
}
@media (pointer: coarse) {
  .screen-close { padding: 10px 14px; font-size: 16px; }
}
/* ì‹œì‘ ë²„íŠ¼: í•˜ë‹¨ ë°€ì°© */
.screen .sh-start {
  position: absolute;
  left: 0; right: 0; bottom: 0;
  height: 15vh; 
  display: flex; align-items: center; justify-content: center;
  font-size: 2em;
  border: 0; border-radius: 0;
  background: rgba(0,0,0,0.65);
  color: #fff;
  cursor: pointer;
}

/* ë‹¨ê³„ í‘œì‹œ ì˜ì—­: ì‹œì‘ ë²„íŠ¼ ìœ„ ì˜ì—­ì„ ê½‰ ì±„ì›€ */
.screen .sh-area {
  position: absolute;
  top: 0; left: 0; right: 0;
  bottom: 8vh;           /* sh-start ë†’ì´ì™€ ë™ì¼í•˜ê²Œ ë§ì¶¤ */
  display: none;         /* ì‹œì‘ ì „ì—ëŠ” ìˆ¨ê¹€ */
  align-items: center; justify-content: center;
  text-align: center;
  color: #000;           /* ë°°ê²½ìƒ‰ì— ë”°ë¼ ê°€ë…ì„± í•„ìš” ì‹œ ì¡°ì • */
  font-weight: 700;
  font-size: 3em;
  padding: 2vh;
}

/* ë°°í„°ë¦¬ ìœ„ì ¯ */
#battery{
  position: absolute;    
  top: 8px;              
  right: 8px;           
  display: none;         
  align-items: center;
  gap: 6px;
  color: #0B503B;
  font-size: 3vh;
  z-index: 10;           
  opacity: .9;
  user-select: none;
}
#battery .bat {
  position: relative;
  width: 35px; 
  height: 18px;
  border: 2px solid #fff;
  border-radius: 3px;
  box-sizing: border-box;
}
#battery .bat::after {  
  content: "";
  position: absolute;
  right: -4px; top: 4px;
  width: 4px; height: 5px;
  background: #fff; border-radius: 1px;
}
#battery .bat > i {
  display: block;
  height: 100%;
  width: var(--level, 0%);
  background: #fff;
  transition: width .25s ease;
}
#battery #batText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 11px;
    color: black;
    font-weight: bold;
}
  </style>
</head>

<body>

<div id="app">
  <!-- ì™¼ìª½: ë‚ ì§œ + ì‹œê°„ -->
<div id="left-container">
  <div id="year-container"></div> <!-- ë…„ë„ -->
  <div id="monthday-container"></div> <!-- ì›”, ì¼, ìš”ì¼ -->
  <div id="time-container"></div> <!-- ì‹œê°„ -->
  <div id="battery">
    <div class="bat">
      <i></i>
      <span id="batText">--%</span>
    </div>
    <span id="chargingIcon" style="display:none;">âš¡</span>
</div>

</div>

  <!-- ì˜¤ë¥¸ìª½: ë‹¬ë ¥ -->
  <div id="right-container">
    <div id="calendar-container">
      <!-- ìš”ì¼ í—¤ë” ì¶”ê°€ -->
      <div class="weekday">æ—¥</div>
      <div class="weekday">æœˆ</div>
      <div class="weekday">ç«</div>
      <div class="weekday">æ°´</div>
      <div class="weekday">æœ¨</div>
      <div class="weekday">ï¤Š</div>
      <div class="weekday">åœŸ</div>
    </div>
  </div>
</div>

  <button class="popButton">
    <h3>< ê´‘ ê³  ></h3>
    <h5>ê²°í˜¼ì–¸ì•½</h5>
    9/28(ì¼) ì˜¤í›„ 4ì‹œ<br>
    ì°½ì„¸ê¸° ì§‘íšŒ ì˜¤í›„ 1ì‹œ
    <h5>ì¶”ì„ì—°íœ´ ì‹ ë¡ ì§‘íšŒ</h5>
    10/3(ê¸ˆ)~10/4(í† )
    <br>
  </button>

<div id="scrim" class="scrim" style="display:none;"></div>
  
<div id="editPopup" style="display:none;" class="popup">
  <div class="popup-inner">
    <input type="text" id="textInput" placeholder="ê´‘ê³  ë‚´ìš© ë³€ê²½" />
    <div class="popup-actions">
      <button id="waterScreenBtn" type="button">ğŸš¿</button>
      <button class="clearButton" type="button"></button>
      <button class="clearButton" type="button"></button>
      <button id="cancelText" type="button">ì·¨ì†Œ</button>
      <button id="confirmText">í™•ì¸</button>
      <button id="restoreText" type="button">ë³µì›</button>
      <button class="clearButton" type="button"></button>
      <button class="clearButton" type="button"></button>
      <button class="clearButton" type="button"></button>
    </div>
  </div>
</div>

<script>
  let wakeLock = null;

  function updateClock() {
    const now = new Date();

    // === ë…„ë„ ===
    const yearContainer = document.getElementById("year-container");
    const year = now.getFullYear();
    yearContainer.innerHTML = `
    <span class="year">${year}</span><span class="year-text">å¹´</span>
  `;

    // === ì›”, ì¼, ìš”ì¼ ===
    const monthdayContainer = document.getElementById("monthday-container");
    const month = now.getMonth() + 1;
    const day = now.getDate();
    const weekday = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"][now.getDay()];
    monthdayContainer.innerHTML = `
    <div>
      <span class="month">${month}</span><span class="month-text">æœˆ</span>
    </div>
    <div>
      <span class="today">${day}</span><span class="today-text">æ—¥</span>
    </div>
    <div>
      <span class="dissweekday">${weekday}</span>
    </div>
  `;

    // === ì‹œê°„ ===
    const timeContainer = document.getElementById("time-container");
    const rawHour = now.getHours();
    const hour12 = rawHour % 12 || 12; // 12ì‹œê°„ì œ
    const hour = String(hour12).padStart(2, "0");
    const minute = String(now.getMinutes()).padStart(2, "0");
    const second = String(now.getSeconds()).padStart(2, "0");

    timeContainer.innerHTML = `
    <div class="time-hour">
      <span class="hour">${hour}:${minute}</span>
    </div>
    <div class="time-second">
      <span class="second">${second}</span>
    </div>
  `;

    // === ë‹¬ë ¥ ===
    generateCalendar(now);
  }

  setInterval(updateClock, 1000);
  updateClock();

  function generateCalendar(currentDate) {
    const calendar = document.getElementById("calendar-container");

    // ìš”ì¼ 7ì¹¸ì€ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì§€ì›€
    while (calendar.children.length > 7) {
      calendar.removeChild(calendar.lastChild);
    }

    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month + 1, 0).getDate();

    // ë¹ˆì¹¸
    for (let i = 0; i < firstDay; i++) {
      const empty = document.createElement("div");
      calendar.appendChild(empty);
    }

    // ë‚ ì§œ ì±„ìš°ê¸°
    for (let d = 1; d <= lastDate; d++) {
      const date = new Date(year, month, d);
      const day = document.createElement("div");

      // ì˜¤ëŠ˜ ë‚ ì§œë©´ [ìˆ«ì] í‘œì‹œ
      if (d === currentDate.getDate()) {
        day.innerHTML = `<span style="color: yellow;">[</span> ${d} <span style="color: yellow;">]</span>`;
      } else {
        day.textContent = d;
      }

      day.classList.add("day");

      // ì¼/í†  ìƒ‰ìƒ
      if (date.getDay() === 0) {
        day.classList.add("sunday");
      } else if (date.getDay() === 6) {
        day.classList.add("saturday");
      }

      calendar.appendChild(day);
    }
  }

// í™”ë©´ êº¼ì§ ë°©ì§€ í•¨ìˆ˜
  async function enableWakeLock() {
    try {
      wakeLock = await navigator.wakeLock.request("screen");
      console.log("í™”ë©´ êº¼ì§ ë°©ì§€ í™œì„±í™”ë¨");

      wakeLock.addEventListener("release", () => {
        console.warn("Wake Lock í•´ì œë¨, ì¬ìš”ì²­ ì‹œë„");
        enableWakeLock(); // âœ… ì¬ìš”ì²­
      });
    } catch (err) {
      console.error("Wake Lock ì˜¤ë¥˜:", err.name, err.message);
    }
  }

  function playSilentAudio() {
    const audio = new Audio("https://cdn.jsdelivr.net/gh/anars/blank-audio/1-second-of-silence.mp3");
    audio.loop = true;
    audio.play().catch(e => console.warn("Audio play error:", e));
  }

  // í˜ì´ì§€ ì§„ì… ì‹œ 1íšŒ ìš”ì²­
  enableWakeLock();
    
  /* ======= Immersive(ì „ì²´í™”ë©´/ê°€ë¡œ/ì›¨ì´í¬ë½) ë³´ì • ìœ í‹¸ ======= */
  function isFullscreen() {
    return document.fullscreenElement
        || document.webkitFullscreenElement
        || document.msFullscreenElement;
  }
  function requestFullscreenIfNeeded() {
    if (isFullscreen()) return Promise.resolve();
        const el = document.documentElement;
        const p = el.requestFullscreen?.()
        || el.webkitRequestFullscreen?.()
        || el.msRequestFullscreen?.();
    return Promise.resolve(p).catch(()=>{ });
  }
  async function ensureImmersive(reason = 'tap') {
    try {await requestFullscreenIfNeeded(); } catch(e) { }

    // ê°€ë¡œ ê³ ì • (ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” ì „ì²´í™”ë©´ ìƒíƒœì—ì„œë§Œ í—ˆìš©)
        if (screen.orientation?.lock) {
      try {
        if (!String(screen.orientation.type || '').includes('landscape')) {
          await screen.orientation.lock('landscape');
        }
      } catch(e) { /* ê±°ì ˆë¼ë„ ë¬´ì‹œ */}
    }

        // í™”ë©´ êº¼ì§ ë°©ì§€ ì¬ìš”ì²­
        if ('wakeLock' in navigator) {
      try {
        if (!window.wakeLock || window.wakeLock.released) {
          await enableWakeLock();
        }
      } catch(e) { }
    }
  }

  document.addEventListener('pointerdown', () => {
          ensureImmersive('tap');
  }, {passive: true });

  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible') {
      if (!wakeLock || wakeLock.released) {  // â† ê°€ë“œ ì¶”ê°€
        enableWakeLock();
      }
    }
  });

  document.addEventListener('fullscreenchange', () => {
    if (!isFullscreen()) {
          console.warn('ì „ì²´í™”ë©´ í•´ì œ ê°ì§€. ë‹¤ìŒ í„°ì¹˜ì—ì„œ ì¬ë³´ì •í•©ë‹ˆë‹¤.');
    }
  });

  async function initBatteryWidget() {
    const box = document.getElementById('battery');
      if (!box) return;

      // ë¯¸ì§€ì› ë¸Œë¼ìš°ì €ëŠ” ìœ„ì ¯ ìˆ¨ê¹€
      if (!('getBattery' in navigator)) {
        box.style.display = 'none';
      console.warn('Battery API ë¯¸ì§€ì›: ìœ„ì ¯ ìˆ¨ê¹€');
      return;
    }
      try {
      const b = await navigator.getBattery();
      const fill = box.querySelector('.bat > i');
      const txt  = box.querySelector('#batText');

  function render() {
    const pct = Math.round(b.level * 100);
    fill.style.setProperty('--level', `${pct}%`);
    txt.textContent = `${pct}%`; // ìˆ«ì%ëŠ” ë°” ì•ˆ

    // ë²ˆê°œ í‘œì‹œë¥¼ ë”°ë¡œ ì»¨íŠ¸ë¡¤
    const chargingIcon = document.getElementById("chargingIcon");
    if (b.charging) {
      chargingIcon.style.display = "inline";
    } else {
      chargingIcon.style.display = "none";
    }

    box.style.display = 'flex';

    // ìƒ‰ìƒ ì¡°ê±´ (ì±„ì›€ ë°” ìƒ‰ìƒ)
    if (pct <= 20) {
      fill.style.background = "red";      // 20% ì´í•˜ ë¹¨ê°•
    } else if (pct <= 45) {
      fill.style.background = "yellow";   // 45% ì´í•˜ ë…¸ë‘
    } else {
      fill.style.background = "white";    // ê¸°ë³¸ í°ìƒ‰
    }
  }


      render();
        b.addEventListener('levelchange', render);
        b.addEventListener('chargingchange', render);
      } catch (e) {
        box.style.display = 'none';
      console.warn('Battery ìœ„ì ¯ ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
    }
  }
  document.addEventListener('DOMContentLoaded', initBatteryWidget);

  document.addEventListener("DOMContentLoaded", () => {
    const popButton = document.querySelector(".popButton");
    const editPopup = document.getElementById("editPopup");
    const textInput = document.getElementById("textInput");
    const confirmText = document.getElementById("confirmText");
    const cancelText = document.getElementById("cancelText");
    const restoreText = document.getElementById("restoreText");
    const scrim = document.getElementById("scrim");

    let isWhite = false;
    const defaultHTML = popButton.innerHTML;

    const saved = localStorage.getItem("popButtonText");
    if (saved) popButton.textContent = saved;

    popButton.addEventListener("click", () => {
      isWhite = !isWhite;
      popButton.style.backgroundColor = isWhite ? "white" : "rgba(0,0,0,0)";
      popButton.style.color = isWhite ? "black" : "rgba(0,0,0,0)";
    });

    /* ê¸¸ê²Œ ëˆŒëŸ¬ í¸ì§‘ ì—´ê¸° */
    let pressTimer;
    const openPopup = () => {
      editPopup.style.display = "block";
      if (scrim) scrim.style.display = "block"; 
      textInput.focus();
    };
    const closePopup = () => {
      editPopup.style.display = "none";
      if (scrim) scrim.style.display = "none";  
    };

    const startPress = () => {
      if (!isWhite) return;
      pressTimer = setTimeout(() => {
        textInput.value = popButton.textContent;
        openPopup();
      }, 1500);
    };
    const cancelPress = () => clearTimeout(pressTimer);

    popButton.addEventListener("mousedown", startPress);
    popButton.addEventListener("mouseup", cancelPress);
    popButton.addEventListener("mouseleave", cancelPress);
    popButton.addEventListener("touchstart", startPress);
    popButton.addEventListener("touchend", cancelPress);

    /* í™•ì¸(ì €ì¥) */
    confirmText.addEventListener("click", () => {
      let newText = textInput.value.trim();
      if (newText) {
        newText = newText.replace(/;/g, "\n");
        popButton.textContent = newText;
        localStorage.setItem("popButtonText", newText);
      }
      closePopup(); 
    });

    /* ì·¨ì†Œ */
    cancelText.addEventListener("click", () => {
      closePopup(); 
    });

    /* ë³µì› */
    restoreText.addEventListener("click", () => {
      popButton.innerHTML = defaultHTML;
      textInput.value = "";
      localStorage.removeItem("popButtonText");
      closePopup(); 
    });
  });

  const waterScreenBtn = document.getElementById('waterScreenBtn');
  if (waterScreenBtn) {
    waterScreenBtn.addEventListener('click', () => {
      closeVisiblePopups(); // 1) íŒì—… ë¨¼ì € ë‹«ê¸° (+ scrim ìˆ¨ê¹€)
      openScreen();         // 2) ìŠ¤í¬ë¦° ì—´ê¸° (ê¸°ì¡´ êµ¬í˜„ ê·¸ëŒ€ë¡œ)
    });
  }

  // â”€â”€ ê³µìš©: ìŠ¤í¬ë¦°/ë‹«ê¸° ë²„íŠ¼ ë³´ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function ensureScreen() {
    let screen = document.querySelector(".screen");
    if (!screen) {
      screen = document.createElement("div");
      screen.className = "screen";
      document.body.appendChild(screen);
    }
    // ì¢Œìƒë‹¨ ë‹«ê¸° ë²„íŠ¼ ë³´ì¥
    let closeBtn = screen.querySelector(".screen-close");
    if (!closeBtn) {
      closeBtn = document.createElement("button");
      closeBtn.type = "button";
      closeBtn.className = "screen-close";
      closeBtn.setAttribute("aria-label", "ìŠ¤í¬ë¦° ë‹«ê¸°");
      closeBtn.textContent = "âœ•";
      closeBtn.addEventListener("click", () => {
        // ì¸í„°ë²Œ ì •ë¦¬ í›„ ë‹«ê¸°
        if (screen._shower?.stepInterval) clearInterval(screen._shower.stepInterval);
        screen.style.display = "none";
        screen.style.backgroundColor = ""; // ë°°ê²½ ì´ˆê¸°í™”
      });
      screen.appendChild(closeBtn);
    }
    return screen;
  }

  function ensureShowerTimerMounted(screen) {
    // ì´ë¯¸ ë§ˆìš´íŠ¸ë˜ì–´ ìˆìœ¼ë©´ ì¬ì‚¬ìš©
    if (screen._shower && screen.querySelector(".sh-start")) return;

    // ì‹œì‘ ë²„íŠ¼(í•˜ë‹¨ ë°€ì°©)
    const startBtn = document.createElement("button");
    startBtn.className = "sh-start";
    startBtn.textContent = "ì‹œì‘";
    screen.appendChild(startBtn);

    // ë‹¨ê³„ í‘œì‹œ ì˜ì—­(ì‹œì‘ ë²„íŠ¼ ìœ„ ì „ì²´)
    const area = document.createElement("div");
    area.className = "sh-area";
    screen.appendChild(area);

    // ë‹¨ê³„ ì •ì˜ (ì›ë³¸ê³¼ ë™ì¼)
    const steps = [
      { text: 'ìƒ¤ì›Œ ì¤€ë¹„', duration: 30, color: '#aaaaaa' },
      { text: 'ë¬¼ ë¬»íˆê¸°', duration: 80, color: '#FFB3BA' },
      { text: 'ìƒ´í‘¸', duration: 60, color: '#FFDFBA' },
      { text: 'ë°”ë””ì›Œì‹œ', duration: 100, color: '#FFFFBA' },
      { text: 'í´ë Œì§•í¼', duration: 60, color: '#BAFFC9' },
      { text: 'í—¹êµ¬ê¸°', duration: 150, color: '#BAE1FF' },
      { text: 'ë¬¼ê¸°ì œê±°', duration: 300, color: '#CBAAFF' },
      { text: 'í™˜ë³µ', duration: 120, color: '#FFC1FF' },
    ];

    // ìƒíƒœ ì €ì¥
    const sh = {
      currentStep: 0,
      stepInterval: null,
      area,
      startBtn,
      screen,
    };
    screen._shower = sh;

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = String(seconds % 60).padStart(2, '0');
      return `${m}:${s}`;
    }

    function resetToInitialState() {
      if (sh.stepInterval) clearInterval(sh.stepInterval);
      sh.currentStep = 0;
      sh.area.style.display = "none";
      sh.area.innerHTML = "";
      sh.screen.style.backgroundColor = ""; // ì „ì²´ ë°°ê²½ ì´ˆê¸°í™”
      sh.startBtn.disabled = false;
    }

    function runStep(index) {
      if (index >= steps.length) { resetToInitialState(); return; }

      const step = steps[index];
      // âœ… ë°°ê²½ìƒ‰ì„ .screen ì „ì²´ì— ì ìš©
      sh.screen.style.backgroundColor = step.color;

      sh.area.style.display = "flex";
      sh.area.innerHTML = `
      <div>
        <div style="margin-bottom: 3vh;">${step.text}</div>
        <div id="sh-timer" style="margin-top:3vh;">${formatTime(step.duration)}</div>
      </div>
    `;

      let timeLeft = step.duration;
      if (sh.stepInterval) clearInterval(sh.stepInterval);
      sh.stepInterval = setInterval(() => {
        timeLeft--;
        const t = sh.area.querySelector("#sh-timer");
        if (t) t.textContent = formatTime(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(sh.stepInterval);
          sh.currentStep++;
          runStep(sh.currentStep);
        }
      }, 1000);
    }

    function startSequence() {
      if (sh.stepInterval) clearInterval(sh.stepInterval);
      sh.currentStep = 0;

      sh.area.style.display = "none";
      sh.area.innerHTML = "";
      sh.screen.style.backgroundColor = "";

      sh.startBtn.disabled = false;

      runStep(sh.currentStep);
    }


    sh.startBtn.addEventListener("click", startSequence);
  }

  function openScreen() {
    const screen = ensureScreen();
    ensureShowerTimerMounted(screen);
    screen.style.display = "block";
  }

  function closeVisiblePopups() {
    const popups = document.querySelectorAll('.popup');
    let closedAny = false;

    popups.forEach(p => {
      const disp = getComputedStyle(p).display;
      if (disp !== 'none') {
        p.style.display = 'none';
        closedAny = true;
      }
    });

    // íŒì—…ì´ í•˜ë‚˜ë¼ë„ ë‹«í˜”ë‹¤ë©´ scrimë„ ìˆ¨ê¹€
    if (closedAny) {
      const scrim = document.getElementById('scrim');
      if (scrim) scrim.style.display = 'none';
    }
  }
</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js')
      .then(reg => console.log("SW ë“±ë¡ ì„±ê³µ:", reg))
      .catch(err => console.error("SW ë“±ë¡ ì‹¤íŒ¨:", err));
  }
</script>

</body>

</html>
